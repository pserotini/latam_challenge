name: Continuous Delivery

on:
  workflow_run:
    workflows: ["Continuous Integration"]
    branches:
      - main
    types:
      - completed

jobs:
  deploy:
    name: Deploy to EC2 Instance
    runs-on: ubuntu-latest
    needs: CI
    if: ${{ needs.CI.result == 'success' }}

    env:
      EC2_SSH: ${{ secrets.EC2_SSH }}

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Install dependencies
        run: make install

      - name: Deploy using Python script
        run: python3 deployment/deploy.py
